# 测试题 2

具体答案见 `final_quiz2.pdf`。

## 要求

为流水线 CPU 自行添加一个新指令 cont，指令类型格式和对应机器码自行确定。

将你的学号后 8 位作为一个 16 进制数据放在数据存储器 0 地址，计算这个数的二进制表示中 1 的个数，并通过 `A8h` 端口输出。设计测试代码完成仿真。

测试代码要完成如下循环动作：
1. 从数据存储器 0 地址处读入数据到 R4。
2. 按照新指令对 R4 的数据执行操作，将结果写入 R6 寄存器。
3. 将结果也写入 `A8h` 输出端口。

自行编写仿真激励波形文件，要求如下：
1. CPU 指令周期设置为 20 ns，CPU 复位信号初值为复位有效状态，30 ns 后无效。
2. 必选观测信号：CPU 复位信号、CPU 工作时钟、imem 指令存储器读时钟、datamem 的读写时钟、PC 指针、指令数据、CPU 内部寄存器 R0 至 R6。

答题格式：
1. 新指令的指令机器码定义方案说明（指令类型，编码格式）。
2. 为增加新指令，说明要修改的模块，以及具体的修改内容。
3. 测试新指令的 CPU 汇编代码和对应的测试新指令的 imem、dmem 存储器初值 .mif 文件，测试文件中新指令机器码构成依据简要说明。
4. 从起始时间开始包含两次计算汉明重量的循环的仿真波形截图及简要说明。